<app-page-header [title]="'Details'" [hasBackIcon]="true"></app-page-header>

<ion-content>
  <ng-container *ngIf="offers">
    <ion-card>
      <img [src]="offers.image" alt="img" loading="lazy" />
    </ion-card>
    <div>
      <ng-container *ngIf="offers && isUser">
        <span class="heart-icon">
          <span (click)="removeFromFavorite()" *ngIf="isFavorite">
            <ion-icon class="favorite" name="heart"></ion-icon>
          </span>
          <span (click)="addToFavorite()" *ngIf="!isFavorite">
            <ion-icon class="not-favorite" name="heart-outline"></ion-icon>
          </span>
        </span>
      </ng-container>
    </div>

    <div class="details">
      <div class="contact">
        <ion-chip color="tertiary">
          <ion-icon color="medium" name="globe-outline"></ion-icon>
          <a href="{{offers.site}}" target="_blank">{{offers.site}}</a>
        </ion-chip>
        <ion-chip color="tertiary">
          <ion-icon color="medium" name="call-outline"></ion-icon>
          <ion-label>{{offers.phoneNumber}}</ion-label>
        </ion-chip>
      </div>

      <div class="report">
        <div (click)="report()" *ngIf="isUser" color="danger">
          <ion-icon color="warning" name="flag-outline"></ion-icon>
          <br>
          <ion-note>{{'Report'}}</ion-note>
        </div>
        <div (click)="remove()" *ngIf="isAdmin">
          <ion-icon name="trash" color="danger"></ion-icon>
        </div>
      </div>

      <div class="subscription" *ngIf="isUser">
        <div side="start" *ngIf="(users | async)?.length > 0">

          <ng-container *ngFor="let user of users | async">

            <ng-container *ngIf="user.id === offers.shopOwnerId">




              <ng-container *ngIf="user.subscriberList">

                <ng-container *ngIf="user.subscriberList.length === 0 || !isUserInList(user)">
                  <ion-chip outline color="tertiary" (click)="subscribe(offers.shopOwnerId)">
                    <!-- <ion-label color="dark">{{'subscribe'}}</ion-label> -->
                    <ion-icon name="notifications-outline"></ion-icon>
                  </ion-chip>
                </ng-container>

                <ng-container *ngFor="let a of user.subscriberList">
                  <ion-chip outline color="tertiary"
                    *ngIf="a.userId === currentUser && a.subStatus === subStatus.unSubscribe"
                    (click)="subscribe(offers.shopOwnerId)">
                    <ion-icon name="notifications-outline"></ion-icon>
                    <!-- <ion-label color="dark">{{'subscribe'}}</ion-label> -->
                  </ion-chip>
                </ng-container>

                <ng-container *ngFor="let a of user.subscriberList">
                  <ion-chip outline color="tertiary"
                    *ngIf="(a.subStatus === subStatus.subscribe && a.userId === currentUser)"
                    (click)="unsubscribe(offers.shopOwnerId)">
                    <ion-icon name="notifications-off-outline"></ion-icon>
                    <!-- <ion-label color="dark">{{'subscribed'}}</ion-label> -->
                  </ion-chip>
                </ng-container>

              </ng-container>
            </ng-container>
          </ng-container>
        </div>
      </div>

      <div class="brandName">
        <ion-chip outline color="tertiary">
          <ion-label color="dark">{{getName(offers.shopOwnerId)}}</ion-label>
        </ion-chip>
      </div>

      <div class="contact">
        <hr>
        <div>{{'Promo Code'}}:</div>
        {{offers.promoCode}}
      </div>

      <div class="contact">
        <hr>
        <div>{{'location' }}:</div>
        {{offers.location}}
      </div>

      <div class="contact">
        <hr>
        <div>{{'Valid From' }}:</div>
        {{offers.startDate.toDate() | date:'mediumDate'}}
      </div>

      <div class="contact">
        <hr>
        <div>{{'Valid until' }}:</div>
        {{offers.endDate.toDate() | date:'mediumDate'}}
      </div>

      <div class="contact">
        <hr>
        <div>{{'description' }}:</div>
        {{offers.description}}
      </div>
      <hr>
      <app-rating></app-rating>
    </div>
  </ng-container>

</ion-content>